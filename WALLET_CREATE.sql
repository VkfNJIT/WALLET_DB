-- Disable foreign key checks
SET FOREIGN_KEY_CHECKS = 0;

-- Drop existing tables to avoid errors
DROP TABLE IF EXISTS WALLET_USER_ACCOUNT;
DROP TABLE IF EXISTS BANK_ACCOUNT;
DROP TABLE IF EXISTS LINKED_TO;
DROP TABLE IF EXISTS ELECTRO_ADDR;
DROP TABLE IF EXISTS SEND_TRANS;
DROP TABLE IF EXISTS CANCELLED_SEND_TRANS;
DROP TABLE IF EXISTS REQUEST_TRANS;
DROP TABLE IF EXISTS REQUESTED_FROM;

-- Enable foreign key checks again
SET FOREIGN_KEY_CHECKS = 1;

-- Create WALLET_USER_ACCOUNT table
-- Make sure balance is derived
CREATE TABLE WALLET_USER_ACCOUNT (
    SSN INTEGER PRIMARY KEY,
    FNAME VARCHAR(50),
    LNAME VARCHAR(50),
    BALANCE DECIMAL(10, 2) DEFAULT 0,
    CONFIRMED BOOLEAN
);

-- Create BANK_ACCOUNT table
CREATE TABLE BANK_ACCOUNT (
    BANKID INTEGER,
    BANUMBER INTEGER,
    PRIMARY KEY (BANKID, BANUMBER)
);

-- Create LINKED_TO table
CREATE TABLE LINKED_TO (
    BANKID INTEGER,
    BANUMBER INTEGER,
    WSSN INTEGER,
    BVERIFIED BOOLEAN,
    PRIMARY KEY (BANKID, BANUMBER, WSSN),
    FOREIGN KEY (BANKID, BANUMBER) REFERENCES BANK_ACCOUNT(BANKID, BANUMBER),
    FOREIGN KEY (WSSN) REFERENCES WALLET_USER_ACCOUNT(SSN)
);

-- Create ELECTRO_ADDR table
CREATE TABLE ELECTRO_ADDR (
    IDENTIFIER VARCHAR(100) PRIMARY KEY,
    WASSN INTEGER,
    TYPE VARCHAR(10) CHECK (TYPE IN ('email', 'phone')),
    VERIFIED BOOLEAN,
    FOREIGN KEY (WASSN) REFERENCES WALLET_USER_ACCOUNT(SSN)
);
-- Create SEND_TRANS table
CREATE TABLE SEND_TRANS (
    STID INTEGER PRIMARY KEY AUTO_INCREMENT,
    SSSN INTEGER,
    STO VARCHAR(100),
    SAMOUNT DECIMAL(10, 2),
    IN_DATE_TIME DATETIME,
    COMP_DATE_TIME DATETIME,
    SMEMO VARCHAR(250),
    FOREIGN KEY (SSSN) REFERENCES WALLET_USER_ACCOUNT(SSN),
    FOREIGN KEY (STO) REFERENCES ELECTRO_ADDR(IDENTIFIER)
);

-- ADD to front end 
-- Create CANCELLED_SEND_TRANS table
CREATE TABLE CANCELLED_SEND_TRANS (
    STID INTEGER PRIMARY KEY,
    CANCELLATION_REASON VARCHAR(250),
    FOREIGN KEY (STID) REFERENCES SEND_TRANS(STID)
);

-- Create REQUEST_TRANS table
CREATE TABLE REQUEST_TRANS (
    RTID INTEGER PRIMARY KEY AUTO_INCREMENT,
    RSSN INTEGER,
    RAMOUNT DECIMAL(10, 2),
    RT_DATE_TIME DATETIME,
    RMEMO VARCHAR(250),
    FOREIGN KEY (RSSN) REFERENCES WALLET_USER_ACCOUNT(SSN)
);

-- Create REQUESTED_FROM table
CREATE TABLE REQUESTED_FROM (
    RTID INTEGER,
    RFROM VARCHAR(100),
    PERCENTAGE REAL CHECK (PERCENTAGE >= 0 AND PERCENTAGE <= 100),
    PRIMARY KEY (RTID, RFROM),
    FOREIGN KEY (RTID) REFERENCES REQUEST_TRANS(RTID),
    FOREIGN KEY (RFROM) REFERENCES ELECTRO_ADDR(IDENTIFIER)
);

# TO BE CONTINUED
-- Populate WALLET_USER_ACCOUNT
-- Insert data into WALLET_USER_ACCOUNT

INSERT INTO WALLET_USER_ACCOUNT (SSN, FNAME, LNAME, BALANCE, CONFIRMED)
VALUES
(123456789, 'John', 'Doe', 1500.75, TRUE),
(987654321, 'Jane', 'Smith', 2500.50, TRUE),
(555555555, 'Alice', 'Johnson', 1200.00, FALSE),
(111223344, 'Bob', 'Williams', 3500.00, TRUE),
(445566778, 'Charlie', 'Brown', 1000.00, TRUE),
(222333444, 'David', 'Lee', 800.00, TRUE),
(333444555, 'Eva', 'Miller', 2200.50, TRUE),
(666777888, 'Frank', 'Taylor', 1800.30, TRUE);

-- Insert data into BANK_ACCOUNT
INSERT INTO BANK_ACCOUNT (BANKID, BANUMBER)
VALUES
(1, 10001),
(2, 20001),
(3, 30001),
(4, 40001),
(5, 50001),
(6, 60001),
(7, 70001);

-- Insert data into LINKED_TO
INSERT INTO LINKED_TO (BANKID, BANUMBER, WSSN, BVERIFIED)
VALUES
(1, 10001, 123456789, TRUE),
(2, 20001, 987654321, FALSE),
(3, 30001, 555555555, TRUE),
(4, 40001, 111223344, TRUE),
(5, 50001, 445566778, FALSE),
(6, 60001, 222333444, TRUE),
(7, 70001, 333444555, TRUE);

-- Insert data into ELECTRO_ADDR
INSERT INTO ELECTRO_ADDR (IDENTIFIER, WASSN, TYPE, VERIFIED)
VALUES
('john.doe@example.com', 123456789, 'email', TRUE),
('jane.smith@example.com', 987654321, 'email', FALSE),
('alice.johnson@example.com', 555555555, 'email', TRUE),
('bob.williams@example.com', 111223344, 'email', TRUE),
('charlie.brown@example.com', 445566778, 'email', TRUE),
('david.lee@example.com', 222333444, 'email', TRUE),
('eva.miller@example.com', 333444555, 'email', TRUE),
('frank.taylor@example.com', 666777888, 'email', TRUE),
('555-123-4567', 123456789, 'phone', TRUE),
('555-987-6543', 987654321, 'phone', FALSE),
('555-555-1234', 555555555, 'phone', TRUE),
('555-111-2233', 111223344, 'phone', TRUE),
('555-222-3344', 445566778, 'phone', TRUE),
('555-333-4455', 222333444, 'phone', TRUE),
('555-444-5566', 333444555, 'phone', TRUE),
('555-555-6677', 666777888, 'phone', TRUE);

-- Insert data into SEND_TRANS
INSERT INTO SEND_TRANS (SSSN, STO, SAMOUNT, IN_DATE_TIME, COMP_DATE_TIME, SMEMO)
VALUES
(123456789, 'jane.smith@example.com', 500.00, '2024-11-01 12:30:00', '2024-11-01 14:00:00', 'Payment for invoice'),
(987654321, 'bob.williams@example.com', 1000.00, '2024-11-02 10:15:00', '2024-11-02 11:45:00', 'Loan repayment'),
(987654321, 'bob.williams@example.com', 1500.00, '2024-11-02 10:15:00', '2024-11-02 11:45:00', 'Loan repayment'),
(555555555, 'alice.johnson@example.com', 200.00, '2024-11-03 15:30:00', '2024-11-03 17:00:00', 'Gift transfer'),
(111223344, 'charlie.brown@example.com', 300.00, '2024-11-04 16:45:00', '2024-11-04 18:00:00', 'Rent payment'),
(445566778, 'john.doe@example.com', 750.00, '2024-11-05 09:00:00', '2024-11-05 10:30:00', 'Business payment'),
(222333444, 'eva.miller@example.com', 400.00, '2024-11-06 11:30:00', '2024-11-06 13:00:00', 'Refund payment'),
(333444555, 'frank.taylor@example.com', 1500.00, '2024-11-07 08:45:00', '2024-11-07 10:15:00', 'Investment payment');

-- Insert data into CANCELLED_SEND_TRANS
INSERT INTO CANCELLED_SEND_TRANS (STID, CANCELLATION_REASON)
VALUES
(2, 'Sender requested cancellation'),
(5, 'Recipient unreachable');

-- Insert data into REQUEST_TRANS
-- Request should not take money immediately, it has to be send by the user
INSERT INTO REQUEST_TRANS (RSSN, RAMOUNT, RT_DATE_TIME, RMEMO)
VALUES
(123456789, 250.00, '2024-11-01 13:00:00', 'Request for refund'),
(987654321, 500.00, '2024-11-02 11:00:00', 'Loan request'),
(555555555, 150.00, '2024-11-03 15:00:00', 'Request for assistance'),
(111223344, 600.00, '2024-11-04 14:00:00', 'Request for rent support'),
(445566778, 200.00, '2024-11-05 10:30:00', 'Request for business investment');

-- Insert data into REQUESTED_FROM
INSERT INTO REQUESTED_FROM (RTID, RFROM, PERCENTAGE)
VALUES
(1, 'john.doe@example.com', 50.00),
(2, 'bob.williams@example.com', 75.00),
(3, 'alice.johnson@example.com', 60.00),
(4, 'charlie.brown@example.com', 80.00),
(5, 'jane.smith@example.com', 40.00);

